<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<!-- 
  [Gemini] ä¿®æ”¹æ¨™é¡Œä»¥åæ˜ ä½é™¢è—¥å±€ç‰ˆæœ¬ 
-->
<title>å„²ä½æŸ¥è©¢ | Storage Code Finder</title>

<!-- 
  [Gemini] æ–°å¢ï¼šç¶²é  App åœ–ç¤º (Web App Icons)
  è«‹å°‡ä¸‹é¢é€™æ®µç¨‹å¼ç¢¼åŠ å…¥åˆ° <head> æ¨™ç±¤å…§ã€‚
  
  **é‡è¦å‰æ**ï¼š
  æ‚¨å¿…é ˆå°‡ 'OPD.jpg' æª”æ¡ˆä¸Šå‚³åˆ° GitHub å„²å­˜åº«çš„æ ¹ç›®éŒ„ (main åˆ†æ”¯)ã€‚
  ç¨‹å¼æœƒå¾ä»¥ä¸‹ URL è®€å–åœ–ç¤º:
  https://raw.githubusercontent.com/Almightyhao/OPD-Storage-Code-Finding/main/IPD.jpg
-->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0f172a">

<!-- é©ç”¨æ–¼ Apple è£ç½® (iOS) -->
<link rel="apple-touch-icon" href="https://raw.githubusercontent.com/Almightyhao/OPD-Storage-Code-Finding/main/OPD.jpg">

<!-- é©ç”¨æ–¼ Android / ç€è¦½å™¨åˆ†é åœ–ç¤º (Favicon) -->
<link rel="icon" type="image/jpeg" href="https://raw.githubusercontent.com/Almightyhao/OPD-Storage-Code-Finding/main/OPD.jpg">
<link rel="shortcut icon" href="https://raw.githubusercontent.com/Almightyhao/Storage-Code-Finding/main/IPD.jpg">
<!-- [Gemini] åœ–ç¤ºæ–°å¢å®Œç•¢ -->

<style>
:root {--bg:#0f172a;--card:#111827;--muted:#94a3b8;--text:#e5e7eb;--accent:#60a5fa;}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI","Helvetica Neue",Arial;}
.wrap{max-width:960px;margin:40px auto;padding:0 16px}
.card{background:var(--card);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.25);padding:20px}
h1{margin:0 0 8px;font-size:22px}
.sub{color:var(--muted);margin-bottom:16px}
.row{display:flex;gap:10px;flex-wrap:wrap}
input[type=text]{flex:1;min-width:220px;border:1px solid #1f2937;background:#0b1220;color:var(--text);
  border-radius:12px;padding:12px 14px;font-size:16px;outline:none}
input::placeholder{color:#64748b}
button{background:var(--accent);border:0;color:#0b1220;padding:12px 16px;border-radius:12px;cursor:pointer;font-weight:700}
button:disabled{opacity:.6;cursor:not-allowed}
.meta{font-size:12px;color:var(--muted);margin-top:10px}
table{width:100%;border-collapse:separate;border-spacing:0;margin-top:16px;word-break:break-all}
th,td{padding:12px 8px;border-bottom:1px solid #1f2937;text-align:left;vertical-align:middle}
th{font-weight:700;color:#cbd5e1}
tr:hover{background:#0b1220}
.badge{display:inline-block;background:#0b1220;border:1px solid #1f2937;color:#cbd5e1;border-radius:999px;padding:2px 8px;font-size:12px}
.empty{color:var(--muted);padding:24px 8px;text-align:center}
.err{color:#fecaca}
.chk-cell{width:40px;text-align:center}
.chk{width:18px;height:18px;cursor:pointer}
.selected-header{display:flex;align-items:center;justify-content:space-between;margin-top:24px}
.selected-count{font-size:14px;color:#cbd5e1}
.pill{display:inline-block;background:#0b1220;border:1px solid #1f2937;color:#cbd5e1;border-radius:999px;padding:2px 10px;font-size:12px}
.selected-actions{display:flex;gap:8px}
.ghost{background:transparent;border:1px solid #334155;color:#cbd5e1}
.mini{padding:8px 10px;font-size:14px}
.selected-table td,.selected-table th{border-bottom:1px solid #1f2937}

/* âœ… è£œå……æ•¸é‡æ¬„æœ€é©åŒ–ï¼šä¸‰ä½æ•¸å¯¬åº¦ */
.qty-input{
  width:60px;
  border:1px solid #334155;
  background:#0b1220;
  color:#e5e7eb;
  border-radius:8px;
  padding:6px;
  font-size:15px;
  font-weight:600;
  text-align:center;
  outline:none;
}
.qty-input::-webkit-inner-spin-button,
.qty-input::-webkit-outer-spin-button{
  -webkit-appearance:none;margin:0;
}

/* âŒ ç§»é™¤æŒ‰éˆ•è¨­è¨ˆ */
.remove-btn{
  background:transparent;
  border:1px solid #334155;
  color:#cbd5e1;
  padding:4px 8px;
  border-radius:8px;
  cursor:pointer;
  font-size:16px;
  line-height:1;
}
.remove-btn:hover{background:#1f2937;border-color:#475569;color:#fca5a5}

/* ğŸ“± æ‰‹æ©Ÿå¾®èª¿ï¼šç¶­æŒä¸€è¡Œé¡¯ç¤ºä½†ç•¥æ”¾å¯¬å…§è· */
@media (max-width:600px){
  th,td{font-size:14px;padding:10px 6px;}
  .qty-input{width:55px;font-size:15px;}
  .remove-btn{padding:4px 6px;font-size:15px;}
}
</style>
<script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>
</head>
<body>
<div class="wrap"><div class="card">
<h1>å„²ä½æŸ¥è©¢</h1>
<div class="sub">è³‡æ–™ä¾†æºæœƒè‡ªå‹•æŠ“å– GitHub ä¸Š <span class="badge">main</span> åˆ†æ”¯çš„æœ€æ–° Excelã€‚</div>
<div class="row">
  <input id="q" type="text" placeholder="è¼¸å…¥è—¥åï¼ˆæ”¯æ´æ¨¡ç³Šæœå°‹èˆ‡éƒ¨åˆ†é—œéµå­—ï¼‰">
  <button id="reloadBtn">é‡æ–°æ•´ç†</button>
</div>
<div id="meta" class="meta"></div><div id="error" class="meta err"></div>

<table id="tbl">
<thead><tr><th class="chk-cell"><input id="toggleAll" class="chk" type="checkbox"></th><th>è—¥å“åç¨±</th><th>å„²ä½å€</th><th>åº«å­˜å€</th></tr></thead>
<tbody id="tbody"><tr><td colspan="4" class="empty">å°šæœªè¼‰å…¥è³‡æ–™â€¦</td></tr></tbody>
</table>

<div class="selected-header">
  <div class="selected-count">å·²é¸æ¸…å–® <span id="selCount" class="pill">0</span></div>
  <div class="selected-actions">
    <button id="exportBtn" class="ghost mini">åŒ¯å‡º CSV</button>
    <button id="clearBtn" class="ghost mini">å…¨éƒ¨æ¸…ç©º</button>
  </div>
</div>

<table class="selected-table">
<thead><tr><th>è—¥å“åç¨±</th><th>å„²ä½å€</th><th>åº«å­˜å€</th><th>è£œå……æ•¸é‡</th><th>æ“ä½œ</th></tr></thead>
<tbody id="selBody"><tr><td colspan="5" class="empty">å°šç„¡å‹¾é¸é …ç›®</td></tr></tbody>
</table>
</div></div>

<script>
(()=> {
const RAW_URL="https://raw.githubusercontent.com/Almightyhao/Storage-Code-Finding/main/Storage%20Code.xlsx";
const NAME_KEYS=["è—¥å“åç¨±","å“å","è—¥å","Drug","Name","åç¨±"];
const AREA_KEYS=["å„²ä½å€","å„²ä½","å„²å­˜å€","å„²å€","Storage","Location"];
const STOCK_KEYS=["åº«å­˜å€","åº«å­˜","åº«å­˜å€ä½","Stock","Inventory"];
const $q=document.getElementById("q"),$tbody=document.getElementById("tbody"),
$meta=document.getElementById("meta"),$err=document.getElementById("error"),
$reload=document.getElementById("reloadBtn"),$selBody=document.getElementById("selBody"),
$selCount=document.getElementById("selCount"),$clearBtn=document.getElementById("clearBtn"),
$exportBtn=document.getElementById("exportBtn");

let rows=[],fuse=null;const selected=new Set(),qtyMap=new Map();

function pickKey(o,c){for(const k of c)if(k in o)return k;return null;}
function rowId(r){return [r.name,r.area,r.stock].join("||");}
function escapeHTML(s){return s.replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));}

async function loadExcel(){
  $err.textContent="";$reload.disabled=true;$reload.textContent="è¼‰å…¥ä¸­â€¦";
  try{
    const r=await fetch(RAW_URL+"?t="+Date.now());
    if(!r.ok)throw new Error("è®€å–å¤±æ•— "+r.status);
    const buf=await r.arrayBuffer();
    const wb=XLSX.read(buf,{type:"array"});
    const sh=wb.Sheets[wb.SheetNames[0]];
    const js=XLSX.utils.sheet_to_json(sh,{defval:""});
    if(!js.length)throw new Error("Excel ç‚ºç©º");
    const kN=pickKey(js[0],NAME_KEYS),kA=pickKey(js[0],AREA_KEYS),kS=pickKey(js[0],STOCK_KEYS);
    rows=js.map(r=>({name:String(r[kN]??"").trim(),area:String(r[kA]??"").trim(),stock:String(r[kS]??"").trim()})).filter(r=>r.name);
    fuse=new Fuse(rows,{includeScore:true,threshold:0.3,keys:["name"]});
    $meta.textContent=`å…± ${rows.length} ç­† Â· è¼‰å…¥æ™‚é–“ï¼š${new Date().toLocaleString()}`;
    render([]);renderSel();
  }catch(e){$err.textContent="éŒ¯èª¤ï¼š"+e.message;$tbody.innerHTML='<tr><td colspan="4" class="empty">ç„¡æ³•è¼‰å…¥è³‡æ–™</td></tr>';}
  $reload.disabled=false;$reload.textContent="é‡æ–°æ•´ç†";
}

function render(list){
  if(!list.length){$tbody.innerHTML='<tr><td colspan="4" class="empty">è«‹è¼¸å…¥é—œéµå­—æŸ¥è©¢</td></tr>';return;}
  $tbody.innerHTML=list.map(r=>{
    const id=rowId(r),chk=selected.has(id)?"checked":"";
    return `<tr data-id="${escapeHTML(id)}">
      <td class="chk-cell"><input type="checkbox" class="chk" ${chk}></td>
      <td>${escapeHTML(r.name)}</td>
      <td>${escapeHTML(r.area)}</td>
      <td>${escapeHTML(r.stock)}</td>
    </tr>`;
  }).join("");
}

$q.addEventListener("input",()=>{const kw=$q.value.trim();if(!kw){render([]);return;}
  const out=rows.filter(r=>r.name.toLowerCase().includes(kw.toLowerCase()));
  render(out.length?out:(fuse?fuse.search(kw).map(x=>x.item):[]));
});

$tbody.addEventListener("change",e=>{
  const el=e.target;if(!el.classList.contains("chk"))return;
  const tr=el.closest("tr");const id=tr.getAttribute("data-id");
  if(el.checked)selected.add(id);else{selected.delete(id);qtyMap.delete(id);}
  renderSel();
});

function renderSel(){
  const sel=rows.filter(r=>selected.has(rowId(r)));
  if(!sel.length){$selBody.innerHTML='<tr><td colspan="5" class="empty">å°šç„¡å‹¾é¸é …ç›®</td></tr>';return;}
  $selBody.innerHTML=sel.map(r=>{
    const id=rowId(r),qty=qtyMap.get(id)??"";
    return `<tr data-id="${escapeHTML(id)}">
      <td>${escapeHTML(r.name)}</td>
      <td>${escapeHTML(r.area)}</td>
      <td>${escapeHTML(r.stock)}</td>
      <td><input class="qty-input" type="number" min="0" max="999" value="${escapeHTML(String(qty))}" data-qty="${escapeHTML(id)}"></td>
      <td><button class="remove-btn" data-remove="${escapeHTML(id)}">âŒ</button></td>
    </tr>`;
  }).join("");
  $selCount.textContent=sel.length;
}

$selBody.addEventListener("input",e=>{
  const el=e.target.closest("input[data-qty]");if(!el)return;
  const id=el.getAttribute("data-qty"),v=el.value.trim();
  if(v==="")qtyMap.delete(id);else qtyMap.set(id,Math.min(Number(v)||0,999));
});

$selBody.addEventListener("click",e=>{
  const btn=e.target.closest("button[data-remove]");if(!btn)return;
  const id=btn.getAttribute("data-remove");selected.delete(id);qtyMap.delete(id);renderSel();
});

$clearBtn.addEventListener("click",()=>{selected.clear();qtyMap.clear();renderSel();});

$exportBtn.addEventListener("click",()=>{
  const sel=rows.filter(r=>selected.has(rowId(r)));if(!sel.length)return;
  const csv=["è—¥å“åç¨±,å„²ä½å€,åº«å­˜å€,è£œå……æ•¸é‡",...sel.map(r=>{
    const id=rowId(r),qty=qtyMap.get(id)??"";return [r.name,r.area,r.stock,qty].map(x=>`"${String(x).replace(/"/g,'""')}"`).join(",");})].join("\r\n");
  const blob=new Blob([csv],{type:"text/csv;charset=utf-8"});
  const a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download="é¸å–æ¸…å–®.csv";a.click();
});

$reload.addEventListener("click",loadExcel);
loadExcel();
})();
</script>

<!-- ğŸ”— åº•éƒ¨è³‡è¨Š -->
<footer style="text-align:center;margin:24px 0;color:#94a3b8;font-size:13px">
  æœ¬å·¥å…·åŸå§‹ç¢¼èˆ‡æ›´æ–°ç‰ˆå¯æ–¼ 
  <a href="https://github.com/Almightyhao/OPD-Storage-Code-Finding" 
     target="_blank" 
     style="color:#60a5fa;text-decoration:none">
     GitHubï¼šAlmightyhao/OPD-Storage-Code-Finding
  </a> æŸ¥æ‰¾ã€‚
</footer>

</body>
</html>
</body>
</html>




